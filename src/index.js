const {Worker} = require('worker_threads');
const Blockchain = require("./Blockchain");

const PRIV_KEY = "3082025b020100028181009ba0e03c24b3c11d2176f06fc4b45cb269e511dd5240829bb6d64446b02e04e479024340d77bad5f690755a63d9019dcaa5d4732836177dfdbc0f2341353fd443d49da5586a7c54388e5d5c07d0c78b275f7688ab0b3fb8bfde8377dceaa6b697c2525273f3da271dd0cfd2aef38d156120eee64b061ce4ae0f2049332cf75b102030100010281807865dc340b3cd9407d1c33e473ec08eeaa07e26b336fdedb3276cf3954a1357dbfb4256d6b872dd86b3b966256ac3da5be530d7aa1b36cf6cd5e96c1fcd5f44f77897580754bdbc46bef9e141548c24accc226443babef506ff4f398c9ed20eff8fea34075c724ea4e3b1eb5d298b4ba831295606c6f285d50782dbf923ce341024100e66326bbf249dc990474f3c5cb63474832d04082a2ee8acf616f14d026b8ccf5d19b680025a2f2d1e23f0dd1b36aa76c9faa4bed33fe0afe002a3150c5228ed9024100acee140902f7da98fa56fd84e8c384465cb7a4fa2f15c8922940d81526efda3803e02cd0c60588aee25d362dde943f652b2c6b651cdef07bb9b7a6c98ce70699024045445a48f7b7ad53743b956f4a8f36c7463fc6a580472804e1ce7bfb7928e6b6a1a68fc63b8a9a66f016f518af50c9b5a6eb949864a164bca9600623baa1814102400afd726e842ec648b49834b26eac864a8677f1572908e45f4d99de61b1c0ca8886ce876a993b1ecda67b3007483ef9ac6f4afa6449aa6d741f80696c23b546f9024060c835536f6f03dee94bfc09fcee71f4fc520603128bdbce2cde96000b30e969c111d90651cbc96c0abbfa2f9abcadde286d9740bd51cd790bfc4f4134f2e6fe";
const PUB_KEY = "30819f300d06092a864886f70d010101050003818d00308189028181009ba0e03c24b3c11d2176f06fc4b45cb269e511dd5240829bb6d64446b02e04e479024340d77bad5f690755a63d9019dcaa5d4732836177dfdbc0f2341353fd443d49da5586a7c54388e5d5c07d0c78b275f7688ab0b3fb8bfde8377dceaa6b697c2525273f3da271dd0cfd2aef38d156120eee64b061ce4ae0f2049332cf75b10203010001";

const blockchain = new Blockchain(PRIV_KEY);
blockchain.start();
const worker = new Worker("./src/CLIWorker.js");
worker.on("message", data => {
    if (data.action === "getBalance") {
        const balance = blockchain.getBalance();
        console.log(balance / 10 ** 8);
    } else if (data.action === "sendTransaction") {
        //const txHash = blockchain.sendTx(data.amount * (10 ** 8),data.to);
        console.log(txHash);
    }
});
setTimeout(() => {
    blockchain.startMining();
}, 3000);